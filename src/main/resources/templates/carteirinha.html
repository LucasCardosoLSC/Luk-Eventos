<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Carteirinha - Sistema de Eventos</title>
</head>
<body>
    <div th:replace="~{layout/base :: content}">
        <div class="container">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="card">
                        <div class="card-header">
                            <h3>Enviar Carteirinha</h3>
                        </div>
                        <div class="card-body">
                            <div th:if="${mensagem}" th:class="${tipoMensagem}" class="alert" role="alert">
                                <span th:text="${mensagem}"></span>
                            </div>
                            
                            <form th:action="@{/api/carteirinhas/upload}" method="post" enctype="multipart/form-data" class="dropzone" id="carteirinhaDropzone">
                                <div class="fallback">
                                    <input name="file" type="file" />
                                </div>
                            </form>
                            
                            <div class="mt-4">
                                <h5>Status da Carteirinha</h5>
                                <div th:if="${carteirinha}" class="alert" th:classappend="${carteirinha.status == 'APROVADA' ? 'alert-success' : carteirinha.status == 'PENDENTE' ? 'alert-warning' : 'alert-danger'}">
                                    <p><strong>Status:</strong> 
                                        <span th:if="${carteirinha.status == 'APROVADA'}">Aprovada</span>
                                        <span th:if="${carteirinha.status == 'PENDENTE'}">Pendente</span>
                                        <span th:if="${carteirinha.status == 'REJEITADA'}">Rejeitada</span>
                                    </p>
                                    <p th:if="${carteirinha.feedback}"><strong>Feedback:</strong> <span th:text="${carteirinha.feedback}"></span></p>
                                </div>
                                <div th:unless="${carteirinha}" class="alert alert-info">
                                    Nenhuma carteirinha enviada ainda.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        Dropzone.autoDiscover = false;
        
        new Dropzone("#carteirinhaDropzone", {
            url: "/api/carteirinhas/upload",
            maxFiles: 1,
            acceptedFiles: "image/*",
            addRemoveLinks: true,
            dictDefaultMessage: "Arraste sua carteirinha aqui ou clique para selecionar",
            dictRemoveFile: "Remover",
            dictCancelUpload: "Cancelar",
            init: function() {
                this.on("success", function(file, response) {
                    window.location.reload();
                });
                this.on("error", function(file, errorMessage) {
                    alert("Erro ao enviar carteirinha: " + errorMessage);
                });
            }
        });
    </script>
</body>
</html> 